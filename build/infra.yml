trigger:
  batch: true
  branches:
    include:
    - main

variables:
  - name: deploymentDefaultLocation
    value: westus

pool:
  vmImage: ubuntu-latest

stages:
- stage: Dev
  jobs:
  - deployment: Deploy
    displayName: Deploy infrastrucre 
    environment: Dev
    strategy:
      runOnce:
        deploy:
          steps:
            - checkout: self
            - task: AzureResourceManagerTemplateDeployment@3
              name: DeployBicepFile
              displayName: Deploy Bicep file
              inputs:
                connectedServiceName: $(ServiceConnectionName)
                deploymentName: $(Build.BuildNumber)
                location: $(deploymentDefaultLocation)
                resourceGroupName: $(ResourceGroupName)
                csmFile: infra/main.bicep
                csmParametersFile: 'main.parameters-dev.json'  # Replace with the path to your Bicep parameter file (parameters.json)
                deploymentOutputs: 'deploymentOutputs.txt'